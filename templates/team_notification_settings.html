{% extends "base.html" %}

{% block title %}Team Notification Settings - Auction System{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8 max-w-4xl">
    <header class="mb-8">
        <h1 class="text-3xl md:text-4xl font-bold gradient-text mb-2">Team Notification Settings</h1>
        <p class="text-gray-600 text-sm md:text-base">Manage your team's notification preferences</p>
    </header>

    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert alert-{{ 'success' if category == 'success' else 'danger' }} mb-4 p-4 rounded-lg border border-{{ 'green' if category == 'success' else 'red' }}-200 bg-{{ 'green' if category == 'success' else 'red' }}-50">
                    <div class="flex items-center">
                        <svg class="w-5 h-5 mr-3 text-{{ 'green' if category == 'success' else 'red' }}-600" fill="currentColor" viewBox="0 0 20 20">
                            {% if category == 'success' %}
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                            {% else %}
                                <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7 4a1 1 0 11-2 0 1 1 0 012 0zm-1-9a1 1 0 00-1 1v4a1 1 0 102 0V6a1 1 0 00-1-1z" clip-rule="evenodd"/>
                            {% endif %}
                        </svg>
                        <span class="text-{{ 'green' if category == 'success' else 'red' }}-800 font-medium">{{ message }}</span>
                    </div>
                </div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Push Notification Subscription -->
    <div class="glass rounded-3xl p-6 mb-6 shadow-lg backdrop-blur-md border border-white/20" id="notification-container">
        <div class="flex items-center justify-between">
            <div>
                <h3 class="text-xl font-semibold text-gray-900 mb-2">Push Notifications</h3>
                <p class="text-gray-600 mb-2">Enable browser push notifications to receive real-time alerts</p>
                <p class="text-sm" id="notification-status">Checking notification status...</p>
                <p class="text-xs text-gray-500 mt-1" id="notification-info">You'll receive notifications even when the app is closed</p>
            </div>
            <div class="flex flex-col gap-2">
                <button type="button" id="enable-notifications" 
                        class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors text-sm font-medium">
                    ðŸ“¢ Enable Push Notifications
                </button>
                <button type="button" id="disable-notifications" 
                        class="px-4 py-2 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors text-sm font-medium hidden">
                    ðŸ”‡ Disable Push Notifications
                </button>
            </div>
        </div>
    </div>

    <div class="glass rounded-3xl p-6 shadow-lg backdrop-blur-md border border-white/20">
        <form method="POST" action="{{ url_for('update_team_notification_settings') }}" class="space-y-8">
            
            <!-- Master Switch -->
            <div class="border-b border-gray-200 pb-6">
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="text-xl font-semibold text-gray-900 mb-2">Team Notifications</h3>
                        <p class="text-gray-600">Enable or disable all team notifications</p>
                    </div>
                    <label class="inline-flex items-center">
                        <input type="checkbox" name="team_notifications_enabled" value="true" 
                               class="sr-only" 
                               {% if team.team_notifications_enabled %}checked{% endif %}>
                        <div class="relative">
                            <div class="toggle-bg bg-gray-200 border border-gray-300 w-14 h-8 rounded-full"></div>
                            <div class="toggle-dot absolute left-1 top-1 bg-white w-6 h-6 rounded-full transition transform"></div>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Notification Categories -->
            <div class="space-y-6" id="notification-categories">
                <!-- Auction Notifications -->
                <div class="notification-category glass p-5 rounded-2xl border border-white/10">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="p-2 rounded-lg bg-blue-100 text-blue-600 mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900">Auction Notifications</h4>
                            </div>
                            <p class="text-gray-600 text-sm mb-3">Get notified about auction rounds, bidding opportunities, and results</p>
                            <ul class="text-xs text-gray-500 space-y-1">
                                <li>â€¢ New auction rounds starting</li>
                                <li>â€¢ Successful and unsuccessful bids</li>
                                <li>â€¢ Auction round completions</li>
                            </ul>
                        </div>
                        <label class="inline-flex items-center ml-4">
                            <input type="checkbox" name="auction_notifications" value="true" 
                                   class="sr-only notification-toggle" 
                                   {% if team.auction_notifications %}checked{% endif %}>
                            <div class="relative">
                                <div class="toggle-bg bg-gray-200 border border-gray-300 w-12 h-6 rounded-full"></div>
                                <div class="toggle-dot absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition transform"></div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Tiebreaker Notifications -->
                <div class="notification-category glass p-5 rounded-2xl border border-white/10">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="p-2 rounded-lg bg-yellow-100 text-yellow-600 mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900">Tiebreaker Notifications</h4>
                            </div>
                            <p class="text-gray-600 text-sm mb-3">Important alerts for tiebreaker situations requiring immediate action</p>
                            <ul class="text-xs text-gray-500 space-y-1">
                                <li>â€¢ New tiebreaker auctions</li>
                                <li>â€¢ Tiebreaker deadlines approaching</li>
                                <li>â€¢ Tiebreaker results</li>
                            </ul>
                        </div>
                        <label class="inline-flex items-center ml-4">
                            <input type="checkbox" name="tiebreaker_notifications" value="true" 
                                   class="sr-only notification-toggle" 
                                   {% if team.tiebreaker_notifications %}checked{% endif %}>
                            <div class="relative">
                                <div class="toggle-bg bg-gray-200 border border-gray-300 w-12 h-6 rounded-full"></div>
                                <div class="toggle-dot absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition transform"></div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Match Notifications -->
                <div class="notification-category glass p-5 rounded-2xl border border-white/10">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="p-2 rounded-lg bg-green-100 text-green-600 mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900">Match Notifications</h4>
                            </div>
                            <p class="text-gray-600 text-sm mb-3">Stay updated on your team's match schedule and results</p>
                            <ul class="text-xs text-gray-500 space-y-1">
                                <li>â€¢ Upcoming match reminders</li>
                                <li>â€¢ Match results and scores</li>
                                <li>â€¢ Schedule changes</li>
                            </ul>
                        </div>
                        <label class="inline-flex items-center ml-4">
                            <input type="checkbox" name="match_notifications" value="true" 
                                   class="sr-only notification-toggle" 
                                   {% if team.match_notifications %}checked{% endif %}>
                            <div class="relative">
                                <div class="toggle-bg bg-gray-200 border border-gray-300 w-12 h-6 rounded-full"></div>
                                <div class="toggle-dot absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition transform"></div>
                            </div>
                        </label>
                    </div>
                </div>

                <!-- Player Notifications -->
                <div class="notification-category glass p-5 rounded-2xl border border-white/10">
                    <div class="flex items-start justify-between">
                        <div class="flex-1">
                            <div class="flex items-center mb-2">
                                <div class="p-2 rounded-lg bg-purple-100 text-purple-600 mr-3">
                                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                    </svg>
                                </div>
                                <h4 class="text-lg font-medium text-gray-900">Player Notifications</h4>
                            </div>
                            <p class="text-gray-600 text-sm mb-3">Updates about your players and team roster changes</p>
                            <ul class="text-xs text-gray-500 space-y-1">
                                <li>â€¢ Player acquisitions and transfers</li>
                                <li>â€¢ Player performance updates</li>
                                <li>â€¢ Team composition changes</li>
                            </ul>
                        </div>
                        <label class="inline-flex items-center ml-4">
                            <input type="checkbox" name="player_notifications" value="true" 
                                   class="sr-only notification-toggle" 
                                   {% if team.player_notifications %}checked{% endif %}>
                            <div class="relative">
                                <div class="toggle-bg bg-gray-200 border border-gray-300 w-12 h-6 rounded-full"></div>
                                <div class="toggle-dot absolute left-0.5 top-0.5 bg-white w-5 h-5 rounded-full transition transform"></div>
                            </div>
                        </label>
                    </div>
                </div>
            </div>

            <!-- Save Button -->
            <div class="pt-6 border-t border-gray-200">
                <div class="flex justify-between items-center">
                    <a href="{{ url_for('dashboard') }}"
                       class="inline-flex items-center px-4 py-2 border border-gray-300 rounded-lg text-sm font-medium text-gray-700 bg-white hover:bg-gray-50 transition-colors">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
                        </svg>
                        Back to Dashboard
                    </a>
                    <button type="submit" 
                            class="inline-flex items-center px-6 py-2 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors font-medium">
                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                        </svg>
                        Save Settings
                    </button>
                </div>
            </div>
        </form>
    </div>
</div>

<!-- Hidden user ID for JavaScript -->
<input type="hidden" id="user-id" value="{{ current_user.id }}">

<style>
/* Toggle Switch Styles */
.toggle-bg {
    transition: background-color 0.2s;
}

.toggle-dot {
    transition: transform 0.2s;
}

input[type="checkbox"]:checked + div .toggle-bg {
    background-color: #3b82f6;
    border-color: #3b82f6;
}

input[type="checkbox"]:checked + div .toggle-dot {
    transform: translateX(2rem);
}

/* Notification Category Styles */
.notification-category {
    transition: all 0.3s ease;
}

.notification-category:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
}

/* Master toggle disabled state */
.notifications-disabled .notification-category {
    opacity: 0.5;
    pointer-events: none;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const masterToggle = document.querySelector('input[name="team_notifications_enabled"]');
    const notificationCategories = document.getElementById('notification-categories');
    
    function updateCategoriesState() {
        if (masterToggle.checked) {
            notificationCategories.classList.remove('notifications-disabled');
        } else {
            notificationCategories.classList.add('notifications-disabled');
        }
    }
    
    masterToggle.addEventListener('change', updateCategoriesState);
    updateCategoriesState(); // Set initial state
});
</script>

<!-- Include notifications JavaScript -->
<script src="{{ url_for('static', filename='js/notifications.js') }}"></script>

{% endblock %}
