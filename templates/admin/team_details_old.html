{% extends "admin/base.html" %}

{% block title %}Team Details - {{ team_info[1] }}{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto">
    <!-- Page Header -->
    <div class="mb-8 flex items-center justify-between">
        <div>
            <h1 class="text-3xl font-bold text-gray-900">{{ team_info[1] }}</h1>
            <p class="mt-2 text-gray-600">{{ team_info[8] }} ({{ team_info[9] }}) • Owner: {{ team_info[6] }}</p>
        </div>
        <div class="flex items-center space-x-4">
            <a href="{{ url_for('admin.season_details', season_id=season_id) }}" 
               class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                <i class="fas fa-arrow-left mr-2"></i>Back to Season
            </a>
        </div>
    </div>

    <!-- Breadcrumb Navigation -->
    <nav class="flex mb-8" aria-label="Breadcrumb">
        <ol class="inline-flex items-center space-x-1 md:space-x-3">
            <li class="inline-flex items-center">
                <a href="{{ url_for('admin.season_management') }}" class="inline-flex items-center text-sm font-medium text-gray-700 hover:text-blue-600">
                    <i class="fas fa-calendar-alt mr-2"></i>Seasons
                </a>
            </li>
            <li>
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                    <a href="{{ url_for('admin.season_details', season_id=season_id) }}" class="text-sm font-medium text-gray-700 hover:text-blue-600">{{ team_info[8] }}</a>
                </div>
            </li>
            <li aria-current="page">
                <div class="flex items-center">
                    <i class="fas fa-chevron-right text-gray-400 mx-2"></i>
                    <span class="text-sm font-medium text-gray-500">{{ team_info[1] }}</span>
                </div>
            </li>
        </ol>
    </nav>

            <!-- Team Info Card -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Team Information</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Team ID:</strong> {{ team_info[0] }}</p>
                            <p><strong>Owner:</strong> {{ team_info[6] }} ({{ team_info[7] }})</p>
                            <p><strong>Current Balance:</strong> ${{ "{:,.2f}".format(team_info[2]) }}</p>
                            <p><strong>Continuing Team:</strong> {{ 'Yes' if team_info[3] else 'No' }}</p>
                        </div>
                        <div class="col-md-6">
                            {% if team_info[4] %}
                                <p><strong>Team Lineage ID:</strong> {{ team_info[4] }}</p>
                            {% endif %}
                            {% if team_info[5] %}
                                <p><strong>Logo:</strong> Available ({{ team_info[6] }})</p>
                            {% endif %}
                            <p><strong>Remaining Budget:</strong> ${{ "{:,.2f}".format(team_stats[9]) }}</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Team Statistics Overview -->
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Team Statistics Overview</h3>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">{{ team_stats[0] }}</h5>
                                    <p class="card-text">Total Bids</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">{{ team_stats[5] }}</h5>
                                    <p class="card-text">Players Acquired</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">${{ "{:,.2f}".format(team_stats[6]) }}</h5>
                                    <p class="card-text">Total Spent</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="card bg-light">
                                <div class="card-body text-center">
                                    <h5 class="card-title">{{ team_stats[1] }}</h5>
                                    <p class="card-text">Rounds Participated</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="card bg-info text-white">
                                <div class="card-body text-center">
                                    <h6 class="card-title">${{ "{:,.2f}".format(team_stats[2]) }}</h6>
                                    <p class="card-text">Average Bid</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-success text-white">
                                <div class="card-body text-center">
                                    <h6 class="card-title">${{ "{:,.2f}".format(team_stats[3]) }}</h6>
                                    <p class="card-text">Highest Bid</p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="card bg-warning text-white">
                                <div class="card-body text-center">
                                    <h6 class="card-title">${{ "{:,.2f}".format(team_stats[7]) }}</h6>
                                    <p class="card-text">Avg Player Cost</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Squad Breakdown by Position -->
            {% if position_breakdown %}
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Squad Analysis by Position</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Position</th>
                                    <th>Players</th>
                                    <th>Avg Rating</th>
                                    <th>Total Spent</th>
                                    <th>Avg Cost</th>
                                    <th>Investment %</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for position in position_breakdown %}
                                <tr>
                                    <td><strong>{{ position[0] }}</strong></td>
                                    <td>{{ position[1] }}</td>
                                    <td>{{ "{:.1f}".format(position[2]) }}</td>
                                    <td>${{ "{:,.2f}".format(position[3]) }}</td>
                                    <td>${{ "{:,.2f}".format(position[4]) }}</td>
                                    <td>{{ "{:.1f}%".format((position[3] / team_stats[6]) * 100) if team_stats[6] > 0 else "0%" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Complete Player Squad -->
            {% if players %}
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Complete Player Squad ({{ players|length }} players)</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Position</th>
                                    <th>Original Team</th>
                                    <th>Rating</th>
                                    <th>Cost</th>
                                    <th>Round</th>
                                    <th>Nationality</th>
                                    <th>Style</th>
                                    <th>Technical</th>
                                    <th>Physical</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for player in players %}
                                <tr>
                                    <td><strong>{{ player[1] }}</strong></td>
                                    <td><span class="badge badge-secondary">{{ player[2] }}</span></td>
                                    <td>{{ player[3] }}</td>
                                    <td><span class="badge badge-primary">{{ player[4] }}</span></td>
                                    <td>${{ "{:,.0f}".format(player[6]) }}</td>
                                    <td><a href="{{ url_for('admin.round_details', season_id=season_id, round_id=(player[8]|string)) }}" class="text-decoration-none">R{{ player[8] }}</a></td>
                                    <td>{{ player[5] or 'N/A' }}</td>
                                    <td>{{ player[7] or 'N/A' }}</td>
                                    <td>
                                        <small>
                                            OA: {{ player[10] or 'N/A' }}<br>
                                            BC: {{ player[11] or 'N/A' }}<br>
                                            DR: {{ player[12] or 'N/A' }}<br>
                                            FI: {{ player[13] or 'N/A' }}
                                        </small>
                                    </td>
                                    <td>
                                        <small>
                                            SP: {{ player[14] or 'N/A' }}<br>
                                            PC: {{ player[15] or 'N/A' }}<br>
                                            DA: {{ player[16] or 'N/A' }}<br>
                                            TA: {{ player[17] or 'N/A' }}
                                        </small>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Round-by-Round Activity -->
            {% if rounds_activity %}
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Round-by-Round Activity</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Round</th>
                                    <th>Start Time</th>
                                    <th>Bids Placed</th>
                                    <th>Avg Bid</th>
                                    <th>Max Bid</th>
                                    <th>Players Won</th>
                                    <th>Amount Spent</th>
                                    <th>Success Rate</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for round_activity in rounds_activity %}
                                <tr>
                                    <td><a href="{{ url_for('admin.round_details', season_id=season_id, round_id=round_activity[0]) }}" class="text-decoration-none"><strong>Round {{ round_activity[1] }}</strong></a></td>
                                    <td>{{ round_activity[2].strftime('%Y-%m-%d %H:%M') if round_activity[2] else 'N/A' }}</td>
                                    <td>{{ round_activity[3] }}</td>
                                    <td>${{ "{:,.0f}".format(round_activity[4]) }}</td>
                                    <td>${{ "{:,.0f}".format(round_activity[5]) }}</td>
                                    <td><span class="badge badge-success">{{ round_activity[6] }}</span></td>
                                    <td>${{ "{:,.0f}".format(round_activity[7]) }}</td>
                                    <td>{{ "{:.1f}%".format((round_activity[6] / round_activity[3]) * 100) if round_activity[3] > 0 else "0%" }}</td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- All Bids History -->
            {% if all_bids %}
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Complete Bidding History ({{ all_bids|length }} bids)</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-sm">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Round</th>
                                    <th>Player</th>
                                    <th>Position</th>
                                    <th>Rating</th>
                                    <th>Bid Amount</th>
                                    <th>Hidden</th>
                                    <th>Result</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for bid in all_bids %}
                                <tr>
                                    <td>{{ bid[3].strftime('%Y-%m-%d %H:%M:%S') if bid[3] else 'N/A' }}</td>
                                    <td>R{{ bid[7] }}</td>
                                    <td><strong>{{ bid[4] }}</strong></td>
                                    <td><span class="badge badge-secondary">{{ bid[5] }}</span></td>
                                    <td>{{ bid[6] }}</td>
                                    <td>${{ "{:,.0f}".format(bid[1]) }}</td>
                                    <td>{{ 'Yes' if bid[2] else 'No' }}</td>
                                    <td>
                                        {% if bid[8] == 'Won' %}
                                            <span class="badge badge-success">Won</span>
                                        {% elif bid[8] == 'Tiebreaker' %}
                                            <span class="badge badge-warning">Tiebreaker</span>
                                        {% else %}
                                            <span class="badge badge-danger">Lost</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Tiebreaker History -->
            {% if tiebreakers %}
            <div class="card mb-4">
                <div class="card-header">
                    <h3>Tiebreaker History</h3>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>Round</th>
                                    <th>Player</th>
                                    <th>Position</th>
                                    <th>Original Amount</th>
                                    <th>New Amount</th>
                                    <th>Timestamp</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for tiebreaker in tiebreakers %}
                                <tr>
                                    <td>R{{ tiebreaker[5] }}</td>
                                    <td><strong>{{ tiebreaker[3] }}</strong></td>
                                    <td><span class="badge badge-secondary">{{ tiebreaker[4] }}</span></td>
                                    <td>${{ "{:,.0f}".format(tiebreaker[1]) }}</td>
                                    <td>${{ "{:,.0f}".format(tiebreaker[6]) }}</td>
                                    <td>{{ tiebreaker[7].strftime('%Y-%m-%d %H:%M:%S') if tiebreaker[7] else 'N/A' }}</td>
                                    <td>
                                        <span class="badge {{ 'badge-success' if tiebreaker[2] else 'badge-warning' }}">
                                            {{ 'Resolved' if tiebreaker[2] else 'Pending' }}
                                        </span>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Back Navigation -->
            <div class="mt-4">
                <a href="{{ url_for('admin.season_details', season_id=season_id) }}" class="btn btn-secondary">← Back to Season Details</a>
                <a href="{{ url_for('admin.season_management') }}" class="btn btn-outline-secondary">← Back to Seasons</a>
            </div>
        </div>
    </div>
</div>
{% endblock %}